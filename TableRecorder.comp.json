{"name":"Comp","obj":{"name":"TableRecorder","category":"UNKNOWN","define":[],"setting":[],"output":[],"metadata":[],"dependency":null,"acc":true,"share":[{"filename":"/home/runner/work/mcstas-time-of-flight-table/mcstas-time-of-flight-table/TableRecorder.comp","line":35,"source":"\n#ifndef _TOF_TABLE_SHARED\n#define _TOF_TABLE_SHARED\n\nextern void* _get_particle_var(char *token, _class_particle *p);\n\nstatic ptrdiff_t _tof_t_offset = -1;\nstatic ptrdiff_t _tof_n_offset = -1;\n\nstatic int _tof_recorder_count = 0;\n\n#define _TOF_T_PTR(particle) (*(double**)((char*)(particle) + _tof_t_offset))\n#define _TOF_N_PTR(particle) (*(int*)  ((char*)(particle) + _tof_n_offset))\n\n#endif /* _TOF_TABLE_SHARED */\n","translated":null}],"user":[],"declare":[{"filename":"/home/runner/work/mcstas-time-of-flight-table/mcstas-time-of-flight-table/TableRecorder.comp","line":53,"source":"\n  /* 0-based index of this recorder into the per-particle tof_t array.\n   * Set at INITIALIZE time by consuming one slot from the shared counter. */\n  int recorder_index;\n","translated":null}],"initialize":[{"filename":"/home/runner/work/mcstas-time-of-flight-table/mcstas-time-of-flight-table/TableRecorder.comp","line":60,"source":"\n  /* Each TableRecorder instance takes the next available index.\n   * INITIALIZE sections run in instrument-file order, so earlier instances\n   * get lower indices, which matches the intended beamline order. */\n  recorder_index = _tof_recorder_count++;\n","translated":null}],"trace":[{"filename":"/home/runner/work/mcstas-time-of-flight-table/mcstas-time-of-flight-table/TableRecorder.comp","line":68,"source":"\n  if (_tof_t_offset >= 0 && _tof_n_offset >= 0) {\n    double* _tof_arr = _TOF_T_PTR(_particle);\n    int     _n       = _TOF_N_PTR(_particle);\n\n    if (_tof_arr && recorder_index < _n) {\n      _tof_arr[recorder_index] = t;\n    }\n  }\n","translated":null}],"save":[],"final":[],"display":[]}}